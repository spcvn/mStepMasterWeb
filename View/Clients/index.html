<div class="row">
    <div class="col-xs-12">
        <div class="clearfix">
            <div class="pull-right tableTools-container"></div>
        </div>
        <div class="table-header">Clients
        </div>
        <div class="dataTable_wrapper">
            <table id="dynamic-table" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th><?= __('no.') ?></th>
                        <th><?= __('client name') ?></th>
                        <th><?= __('sub domain') ?></th>
                        <th><?= __('contact name') ?></th>
                        <th><?= __('phone') ?></th>
                        <th><?= __('status') ?></th>
                        <th><?= __('db connection') ?></th>
                        <th><?= __('action') ?></th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($clients as $client): ?>
                    <tr data-client-id="<?= $client['ClientProfile']['id']?>" data-type="tr-client-info">
                        <td><?= $client['ClientProfile']['id']?></td>
                        <td data-type="client-name"><?= $client['ClientProfile']['client_name']?></td>
                        <td><?= $client['Clients'][0]['short_name']?></td>
                        <td><?= $client['ClientProfile']['contact_name']?></td>
                        <td><?= $client['ClientProfile']['contact_mobile']?></td>
                        <td data-type="client-status"><?= ($client['Clients'][0]['del_flg']==0)?'Activated':'Deactivated'?></td>
                        <td data-type="check-db-status" data-db='{"host":"<?=$client['Clients'][0]['db_host']?>","user":"<?=$client['Clients'][0]['db_user']?>","name":"<?=$client['Clients'][0]['db_name']?>","pass":"<?=$client['Clients'][0]['db_password']?>","port":"<?=$client['Clients'][0]['db_port']?>"}'>Checking...</td>
                        <td class="actions">
                            <div class="hidden-sm hidden-xs action-buttons button-list">
                                <a class="orange" onclick="return false;" data-type="btn-active" href="" <?=($client['Clients'][0]['del_flg']==0)?"style='display:none'":""?>>
                                    <i class="ace-icon fa fa-check bigger-130"></i>
                                </a>

                                <a class="red" onclick="return false;" data-type="btn-deactive" href="" <?=($client['Clients'][0]['del_flg']==1)?"style='display:none'":""?>>
                                    <i class="ace-icon fa fa-ban bigger-130"></i>
                                </a>

                                <a class="green" href="/clients/add/<?=$client['ClientProfile']['id']?>">
                                    <i class="ace-icon fa fa-pencil bigger-130"></i>
                                </a>

                                <a class="blue" href="/clients/detail/<?=$client['ClientProfile']['id']?>">
                                    <i class="ace-icon fa fa-eye bigger-130"></i>
                                </a>
                            </div>

                            <div class="hidden-md hidden-lg button-list">
                                <div class="inline pos-rel">
                                    <button class="btn btn-minier btn-yellow dropdown-toggle" data-toggle="dropdown" data-position="auto">
                                        <i class="ace-icon fa fa-caret-down icon-only bigger-120"></i>
                                    </button>

                                    <ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                        <li data-type="btn-active" <?=($client['Clients'][0]['del_flg']==0)?"style='display:none'":""?>>
                                            <a href="" onclick="return false;" class="tooltip-info" data-rel="tooltip" title="View">
                                                <span class="orange">
                                                    <i class="ace-icon fa fa-check bigger-120"></i>
                                                </span>
                                            </a>
                                        </li>

                                        <li data-type="btn-deactive" <?=($client['Clients'][0]['del_flg']==1)?"style='display:none'":""?>>
                                            <a href="" onclick="return false;" class="tooltip-error" data-rel="tooltip" title="Delete">
                                                <span class="red">
                                                    <i class="ace-icon fa fa-ban bigger-120"></i>
                                                </span>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="/clients/add/<?=$client['ClientProfile']['id']?>" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                <span class="green">
                                                    <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                                </span>
                                            </a>
                                        </li>

                                        <li>
                                            <a href="/clients/detail/<?=$client['ClientProfile']['id']?>" class="tooltip-info" data-rel="tooltip" title="View">
                                                <span class="blue">
                                                    <i class="ace-icon fa fa-eye bigger-120"></i>
                                                </span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/jquery.dataTables.min.js"></script>
<script src="/assets/js/dataTables.buttons.min.js"></script>
<script src="/assets/js/buttons.flash.min.js"></script>
<script src="/assets/js/buttons.html5.min.js"></script>
<script src="/assets/js/buttons.print.min.js"></script>
<script src="/assets/js/buttons.colVis.min.js"></script>
<script src="/assets/js/dataTables.select.min.js"></script>
<script src="/assets/js/jquery.dataTables.bootstrap.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    var myTable = $('#dynamic-table').DataTable();
    $.fn.dataTable.Buttons.defaults.dom.container.className = 'dt-buttons btn-overlap btn-group btn-overlap';
    new $.fn.dataTable.Buttons( myTable, {
        buttons: [
        {
            "extend": "colvis",
            "text": "<i class='fa fa-search bigger-110 blue'></i> <span class='hidden'>Show/hide columns</span>",
            "className": "btn btn-white btn-primary btn-bold",
            columns: ':not(:first):not(:last)'
        },
        {
            "extend": "copy",
            "text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
            "className": "btn btn-white btn-primary btn-bold"
        },
        {
            "extend": "csv",
            "text": "<i class='fa fa-database bigger-110 orange'></i> <span class='hidden'>Export to CSV</span>",
            "className": "btn btn-white btn-primary btn-bold"
        },
        {
            "extend": "excel",
            "text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
            "className": "btn btn-white btn-primary btn-bold"
        },
        {
            "extend": "pdf",
            "text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
            "className": "btn btn-white btn-primary btn-bold"
        },
        {
            "extend": "print",
            "text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
            "className": "btn btn-white btn-primary btn-bold",
            autoPrint: false,
            message: 'This print was produced using the Print button for DataTables'
        }
        ]
    });
    myTable.buttons().container().appendTo( $('.tableTools-container') );

    //style the message box
    var defaultCopyAction = myTable.button(1).action();
    myTable.button(1).action(function (e, dt, button, config) {
        defaultCopyAction(e, dt, button, config);
        $('.dt-button-info').addClass('gritter-item-wrapper gritter-info gritter-center white');
    });
    
    var defaultColvisAction = myTable.button(0).action();
    myTable.button(0).action(function (e, dt, button, config) {
        defaultColvisAction(e, dt, button, config);
        if($('.dt-button-collection > .dropdown-menu').length == 0) {
            $('.dt-button-collection')
            .wrapInner('<ul class="dropdown-menu dropdown-light dropdown-caret dropdown-caret" />')
            .find('a').attr('href', '#').wrap("<li />")
        }
        $('.dt-button-collection').appendTo('.tableTools-container .dt-buttons')
    });
    
    $(function(){
    	var host=location.host;
        var BASE_URL   ="//"+host+"/";
        
        var uiAlert=function(params){

        	var settings={"buttons":{}};
        	settings["title"]=(!!params["title"]?params["title"]:"&nbsp;");
    		settings["main_title"]=(!!params["main_title"]?params["main_title"]:settings["title"]);
        	settings["name"]=(!!params["name"]?params["name"]:"&nbsp;");
        	settings["message"]=(!!params["message"]?params["message"]:"&nbsp;");
    		settings["main_title"]=(!!params["main_title"]?params["main_title"]:params["title"]);
    		settings["close"]=($.isFunction(params["close"])?params["close"]:false);

        	if(!!params["yes"]){

        	    settings["buttons"]["YES"]={};
        	    settings["buttons"]["YES"]["class"]="blue";
        	    settings["buttons"]["YES"]["action"]=function(){

        	        	params["yes"]();
        	    };
        	}

        	if(!!params["no"]){

        	    settings["buttons"]["NO"]={};
        	    settings["buttons"]["NO"]["class"]="gray";
        	    settings["buttons"]["NO"]["action"]=function(){

        	        	params["no"]();
        	    };
        	}

    		var js=document.location.protocol+BASE_URL+"assets/js/jquery.confirm.js";
    		loadScript(js,function(){
    				jQuery.confirm(settings);
    		});
    	}
        $("td[data-type=\"check-db-status\"]").each(function(){
        	var target = $(this);
        	var params = target.data('db');
        	$.post(BASE_URL+'clients/checkConnectDB', params, function (res) {
            	target.html(res['status']);
			}, 'json');
        });
    	
    	$(document).on("mouseup", '[data-type=\"btn-active\"]',function(e){
    		var target=$(this);
    		var client_list_tr=target.parents("tr[data-type=\"tr-client-info\"]");
    		var div_button_parent = target.parent("div.button-list");
    		var client_deactive_btn = div_button_parent.children("[data-type=\"btn-deactive\"]");
            var client_id=client_list_tr.attr("data-client-id");
            var client_name=client_list_tr.children("td[data-type=\"client-name\"]").text();
            var client_status=client_list_tr.children("td[data-type=\"client-status\"]");
            
            uiAlert({

				"main_title":"Alert",
                "title"     :"Active",
                "message"   :"Do you want to active client "+client_name,
                "yes"       :function(){
	                        var params={};
	                        params["client_id"]=client_id;
	                        params["status"]=0;
	                        $.post(BASE_URL+'clients/updateStatus', params, function (res) {
	                        	if (res.status=='YES') {
	                        		client_status.html('Activated');
	                        		target.css("display","none");
	                        		client_deactive_btn.css("display","inline-block");
	                        		uiAlert({
										'title': "Alert",
										'main-title':"Active",
										'message': 'Success',
										'yes': function () {
											target.one(e.type,arguments.callee);
										}
									});
	                        	}else{
	                        		uiAlert({
										'title': "Alert",
										'main-title':"Active",
										'message': 'Fail',
										'yes': function () {
											target.one(e.type,arguments.callee);
										}
									});
	                        	}
							}, 'json');
	                },
                "no"     :function(){
                        target.one(e.type,arguments.callee);
                },
        	});
    	});
    	
    	$(document).on("mouseup", '[data-type=\"btn-deactive\"]',function(e){
    		var target=$(this);
    		var client_list_tr=target.parents("tr[data-type=\"tr-client-info\"]");
    		var div_button_parent = target.parent("div.button-list");
    		var client_active_btn = div_button_parent.children("[data-type=\"btn-active\"]");
            var client_id=client_list_tr.attr("data-client-id");
            var client_name=client_list_tr.children("td[data-type=\"client-name\"]").text();
            var client_status=client_list_tr.children("td[data-type=\"client-status\"]");
            
            uiAlert({

				"main_title":"Alert",
                "title"     :"Deactive",
                "message"   :"Do you want to deactive client "+client_name,
                "yes"       :function(){
	                        var params={};
	                        params["client_id"]=client_id;
	                        params["status"]=1;
	                        $.post(BASE_URL+'clients/updateStatus', params, function (res) {
	                        	if (res.status=='YES') {
	                        		client_status.html('Deactivated');
	                        		target.css("display","none");
	                        		client_active_btn.css("display","inline-block");
	                        		uiAlert({
										'title': "Alert",
										'main-title':"Deactive",
										'message': 'Success',
										'yes': function () {
											target.one(e.type,arguments.callee);
										}
									});
	                        	}else{
	                        		uiAlert({
										'title': "Alert",
										'main-title':"Deactive",
										'message': 'Fail',
										'yes': function () {
											target.one(e.type,arguments.callee);
										}
									});
	                        	}
							}, 'json');
	                },
                "no"     :function(){
                        target.one(e.type,arguments.callee);
                },
        	});
    	});
    });
</script>